<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{user/layouts/layout-user.html}">

<head>
<meta charset="UTF-8">
<title>Danh sách danh mục</title>

<!-- ✅ Dùng CDN Bootstrap -->
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

<style>
table {
	width: 100%;
	border-collapse: collapse;
}

th, td {
	padding: 10px;
	border: 1px solid #ccc;
	text-align: center;
}

.pagination {
	margin: 20px auto;
	text-align: center;
}

.pagination a {
	margin: 0 5px;
	text-decoration: none;
}

.pagination strong {
	color: red;
}
</style>
</head>

<body>
	<!-- ✅ Đặt nội dung vào fragment "content" của layout-user.html -->
	<div layout:fragment="content">
		<div class="container mt-4">
			<h2 class="text-center">Danh sách danh mục</h2>

			<div class="text-end mb-3">
				<a th:href="@{/user/categories/add}" class="btn btn-success">+
					Thêm danh mục</a> <a th:href="@{/user/home}" class="btn btn-secondary">Quay
					lại</a>
			</div>

			<div class="table-responsive">
				<table class="table table-bordered table-striped">
					<thead class="table-dark">
						<tr>
							<th>STT</th>
							<th>Ảnh Icon</th>
							<th>Tên danh mục</th>
							<th>Hành động</th>
						</tr>
					</thead>
					<tbody id="category-table-body">
						<!-- Dữ liệu sẽ được render bằng JavaScript -->
					</tbody>
				</table>
				<div class="pagination" id="pagination-container"></div>
			</div>
		</div>
	</div>

	<!-- ✅ Script section nằm trong fragment "scripts" để layout có thể render -->
	<div layout:fragment="scripts">
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

		<script type="text/javascript">
		// Load dữ liệu theo page
		function loadCategories(page = 0) {
		    $.ajax({
		        url: '/api/category?page=' + page + '&size=5',
		        type: 'GET',
		        success: function (response) {
		            if (response.status) {
		                // Render bảng
		                let rows = '';
		                $.each(response.data, function (index, cate) {
		                    rows += `
		                        <tr>
		                            <td>${index + 1}</td>
		                            <td><img src="/image?fname=${cate.icon}" style="max-width: 80px; max-height: 60px;"></td>
		                            <td>${cate.catename}</td>
		                            <td>
		                                <a href="/user/categories/edit?id=${cate.cateid}" class="btn btn-outline-warning btn-sm">Sửa</a>
		                                <a href="/user/categories/delete?id=${cate.cateid}" class="btn btn-outline-danger btn-sm"
		                                   onclick="return confirm('Bạn có chắc chắn muốn xóa?')">Xóa</a>
		                            </td>
		                        </tr>
		                    `;
		                });
		                $('#category-table-body').html(rows);

		                // Render phân trang
		                let pagination = '';
		                for (let i = 0; i < response.totalPages; i++) {
		                    pagination += `<a href="#" class="page-link ${i === response.currentPage ? 'active' : ''}" data-page="${i}">${i + 1}</a> `;
		                }
		                $('#pagination-container').html(pagination);
		            }
		        },
		        error: function () {
		            $('#category-table-body').html('<tr><td colspan="4">Lỗi tải dữ liệu</td></tr>');
		        }
		    });
		}

		// Click phân trang
		$(document).on('click', '.page-link', function (e) {
		    e.preventDefault();
		    let page = $(this).data('page');
		    loadCategories(page);
		});

		// Load trang đầu tiên
		$(document).ready(function () {
		    loadCategories();
		});
    </script>
	</div>
</body>
</html>
